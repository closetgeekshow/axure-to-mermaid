javascript:(()=>{var y={all:{text:"Full",type:"generate"},startHere:{text:"From Here",type:"generate"},copy:{text:"Copy",type:"copy"},txtDownload:{text:"TXT",type:"download"},svgUrl:{text:"SVG",type:"url"},svgDownload:{text:"SVG",type:"download"},pngUrl:{text:"PNG",type:"url"},pngDownload:{text:"PNG",type:"download"}},g=[["Sitemap",["all","startHere"]],["Code",["copy"]],["Download",["txtDownload","svgDownload","pngDownload"]],["URL",["svgUrl","pngUrl"]]],w=["https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js","https://cdn.jsdelivr.net/npm/js-base64@3.7.5/base64.min.js"],b=["https://matcha.mizu.sh/matcha.lite.css"];async function C(){for(let a of w)await T(a)}function T(a){return new Promise((o,t)=>{let e=document.createElement("script");e.type="text/javascript",e.src=a,e.onload=o,e.onerror=t,document.head.appendChild(e)})}function c(a,o="",t={}){let e=document.createElement(a);e.textContent=o;for(let[n,r]of Object.entries(t))n==="style"&&typeof r=="object"?Object.entries(r).forEach(([s,i])=>{e.style[s]=i}):n==="dataset"&&typeof r=="object"?Object.entries(r).forEach(([s,i])=>{e.dataset[s]=i}):e[n]=r;return e}function l(a){navigator.clipboard.writeText(a).then(()=>{console.log("Raw text copied:",a)})}function u(a){let o={code:a,mermaid:JSON.stringify({theme:"default"},null,2),updateEditor:!0,autoSync:!0,updateDiagram:!0},t=JSON.stringify(o),e=new TextEncoder().encode(t),n=pako.deflate(e,{level:9});return Base64.fromUint8Array(n,!0)}async function m(a,o=!1){let e=`https://mermaid.ink/svg/pako:${u(a)}`;if(o){let r=await(await fetch(e)).text();x(r,"sitemap.svg","image/svg+xml")}else window.open(e,"_blank")}async function f(a,o=!1){let e=`https://mermaid.ink/img/pako:${u(a)}?type=png`;if(o){let r=await(await fetch(e)).blob();x(r,"sitemap.png","image/png")}else window.open(e,"_blank")}function x(a,o,t){let e=new Blob([a],{type:t}),n=URL.createObjectURL(e),r=document.createElement("a");r.href=n,r.download=o,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}function E(a){x(a,"sitemap.txt","text/plain")}var d=class{constructor(o,t){this.processor=o,this.sitemapArray=t,this.currentMermaidText="",this.container=c("div","",{id:"toolbar"}),this.shadow=this.container.attachShadow({mode:"open"});for(let e of b)this.loadCSSInShadow(e);this.toolbar=c("div","",{style:{position:"fixed",display:"flex",flexDirection:"row",bottom:"2vh",right:"2vw",backgroundColor:"white",padding:"10px",border:"1px solid #ccc",zIndex:"1000",gap:"3ch"}}),this.buttons=this.createButtons(),this.attachButtons(),this.shadow.appendChild(this.toolbar),document.body.appendChild(this.container)}loadCSSInShadow(o){let t=document.createElement("style");t.textContent=`@import "${o}";`,this.shadow.appendChild(t)}createButtons(){return Object.entries(y).reduce((o,[t,e])=>(o[t]=c("button",`${e.text}`,{disabled:e.type!=="generate",dataset:{buttonType:e.type},onclick:()=>this.handleButtonClick(t,e.type)}),o),{})}handleButtonClick(o,t){({generate:{all:()=>this.handleAllClick(),startHere:()=>this.handleStartHereClick()},copy:{copy:()=>{console.log(this.currentMermaidText),l(this.currentMermaidText)}},download:{txtDownload:()=>E(this.currentMermaidText),svgDownload:()=>m(this.currentMermaidText,!0),pngDownload:()=>f(this.currentMermaidText,!0)},url:{svgUrl:()=>m(this.currentMermaidText),pngUrl:()=>f(this.currentMermaidText)}})[t]?.[o]?.()}handleAllClick(){let o=this.processor.processSitemap(this.sitemapArray);this.currentMermaidText=this.processor.generateMermaidMarkup(o),l(this.currentMermaidText),this.enableExportButtons()}handleStartHereClick(){let o=top.$axure.page.shortId;if(o||(o=new URLSearchParams(window.parent.location.search).get("id")),!o){let t=new URLSearchParams(window.parent.location.search).get("p");if(t){let e=n=>{for(let r of n){if(r.url&&r.url.replace(".html","")===t)return r.id;if(r.children){let s=e(r.children);if(s)return s}}return null};o=e($axure.document.sitemap.rootNodes)}}if(o){let t=this.processor.findCurrentNode(this.sitemapArray,o);if(t){let e=this.processor.processSitemap([t]);this.currentMermaidText=this.processor.generateMermaidMarkup(e),l(this.currentMermaidText),this.enableExportButtons()}}}enableExportButtons(){Object.values(this.buttons).forEach(o=>{o.dataset.buttonType!=="generate"&&(o.disabled=!1)})}unload(){this.toolbar?.parentNode?.removeChild(this.toolbar)}attachButtons(){g.forEach(([t,e])=>{let n=c("div","",{style:{display:"flex",flexDirection:"column",alignItems:"center",fontSize:".875rem",gap:".25rem"}}),r=c("span",t);n.appendChild(r);let s=c("div","",{style:{display:"flex",gap:".125rem"}});e.forEach(i=>{s.appendChild(this.buttons[i])}),n.appendChild(s),this.toolbar.appendChild(n)});let o=c("button","X",{style:{height:"2rem",width:"2rem",display:"flex",alignItems:"center",justifyContent:"center",margin:"auto 0"},onclick:()=>this.unload()});this.toolbar.appendChild(o)}};var p=class{constructor(){}processSitemap(o,t=1,e=null,n=[]){return o.forEach(r=>{let s=r.id||`folder_${Math.random().toString(36).substr(2,7)}`;n.push({id:s,name:r.pageName,level:t,parentId:e,type:r.type}),r.children&&this.processSitemap(r.children,t+1,s,n)}),n}generateMermaidMarkup(o){let t=["graph TD","classDef containers fill:transparent,stroke-width:0",""],e=Math.max(...o.map(r=>r.level));for(let r=1;r<=e;r++){let s=o.filter(i=>i.level===r);t.push(""),t.push(`  subgraph tier${r}[" "]`),s.forEach(i=>{r===1?t.push(`    ${i.id}["${i.name}"]`):t.push(`    ${i.parentId} --- ${i.id}["${i.name}"]`)}),t.push("  end","")}return t.push(""),t.push(`  class ${Array.from({length:e},(r,s)=>`tier${s+1}`).join(",")} containers`),t.join(`
`)}findCurrentNode(o,t){for(let e of o){if(e.id===t)return e;if(e.children){let n=this.findCurrentNode(e.children,t);if(n)return n}}return null}};var h=class{constructor(){this.init()}async init(){this.toolbar=new d(new p,top.$axure.document.sitemap.rootNodes)}};async function v(){await C(),window.AxureToMermaid=new h}var S=0,k=5,N=500;async function M(){for(;S<k;){if(typeof top.$axure<"u"&&top.$axure.document){v().catch(console.error);return}console.warn("axure.document not ready.","try: ",++S),await new Promise(a=>setTimeout(a,N))}console.error("axure init failed")}M();})();
