javascript:(()=>{var g={all:{text:"Full",type:"generate"},startHere:{text:"From Here",type:"generate"},copy:{text:"Copy",type:"copy"},txtDownload:{text:"TXT",type:"download"},svgUrl:{text:"SVG",type:"url"},svgDownload:{text:"SVG",type:"download"},pngUrl:{text:"PNG",type:"url"},pngDownload:{text:"PNG",type:"download"}},y=[["Sitemap",["all","startHere"]],["Code",["copy"]],["Download",["txtDownload","svgDownload","pngDownload"]],["URL",["svgUrl","pngUrl"]]],b=["https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js","https://cdn.jsdelivr.net/npm/js-base64@3.7.5/base64.min.js"];async function w(){for(let a of b)await v(a)}function v(a){return new Promise((t,r)=>{let e=document.createElement("script");e.type="text/javascript",e.src=a,e.onload=t,e.onerror=r,document.head.appendChild(e)})}function c(a,t="",r={}){let e=document.createElement(a);e.textContent=t;for(let[n,o]of Object.entries(r))n==="style"&&typeof o=="object"?Object.entries(o).forEach(([s,i])=>{e.style[s]=i}):e[n]=o;return e}function l(a){navigator.clipboard.writeText(a).then(()=>{console.log("Raw text copied:",a)})}function u(a){let t={code:a,mermaid:JSON.stringify({theme:"default"},null,2),updateEditor:!0,autoSync:!0,updateDiagram:!0},r=JSON.stringify(t),e=new TextEncoder().encode(r),n=pako.deflate(e,{level:9});return Base64.fromUint8Array(n,!0)}async function h(a,t=!1){let e=`https://mermaid.ink/svg/pako:${u(a)}`;if(t){let o=await(await fetch(e)).text();x(o,"sitemap.svg","image/svg+xml")}else window.open(e,"_blank")}async function f(a,t=!1){let e=`https://mermaid.ink/img/pako:${u(a)}?type=png`;if(t){let o=await(await fetch(e)).blob();x(o,"sitemap.png","image/png")}else window.open(e,"_blank")}function x(a,t,r){let e=new Blob([a],{type:r}),n=URL.createObjectURL(e),o=document.createElement("a");o.href=n,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)}function T(a){x(a,"sitemap.txt","text/plain")}var d=class{constructor(t,r){this.processor=t,this.sitemapArray=r,this.currentMermaidText="",this.toolbar=c("div","",{style:{position:"fixed",display:"flex",flexDirection:"row",bottom:"2vh",right:"2vw",backgroundColor:"white",padding:"10px",border:"1px solid #ccc",zIndex:"1000",gap:"3ch"}}),this.buttons=this.createButtons(),this.attachButtons(),document.body.appendChild(this.toolbar)}createButtons(){return Object.entries(g).reduce((t,[r,e])=>(t[r]=c("button",`${e.text}`,{disabled:e.type!=="generate",dataset:{buttonType:e.type},onclick:()=>this.handleButtonClick(r,e.type)}),t),{})}handleButtonClick(t,r){({generate:{all:()=>this.handleAllClick(),startHere:()=>this.handleStartHereClick()},copy:{copy:()=>{console.log(this.currentMermaidText),l(this.currentMermaidText)}},download:{txtDownload:()=>T(this.currentMermaidText),svgDownload:()=>h(this.currentMermaidText,!0),pngDownload:()=>f(this.currentMermaidText,!0)},url:{svgUrl:()=>h(this.currentMermaidText),pngUrl:()=>f(this.currentMermaidText)}})[r]?.[t]?.()}handleAllClick(){let t=this.processor.processSitemap(this.sitemapArray);console.log("Before assignment:",{asString:this.processor.generateMermaidMarkup(t),asLines:this.processor.generateMermaidMarkup(t).split(`
`)}),this.currentMermaidText=this.processor.generateMermaidMarkup(t),console.log("After assignment:",{asString:this.currentMermaidText,asLines:this.currentMermaidText.split(`
`)}),l(this.currentMermaidText),this.enableExportButtons()}handleStartHereClick(){let t=$axure.page.shortId;if(t||(t=new URLSearchParams(window.parent.location.search).get("id")),!t){let r=new URLSearchParams(window.parent.location.search).get("p");if(r){let e=n=>{for(let o of n){if(o.url&&o.url.replace(".html","")===r)return o.id;if(o.children){let s=e(o.children);if(s)return s}}return null};t=e($axure.document.sitemap.rootNodes)}}if(t){let r=this.processor.findCurrentNode(this.sitemapArray,t);if(r){let e=this.processor.processSitemap([r]);this.currentMermaidText=this.processor.generateMermaidMarkup(e),l(this.currentMermaidText),this.enableExportButtons()}}}enableExportButtons(){Object.values(this.buttons).forEach(t=>{t.dataset.buttonType!=="generate"&&(t.disabled=!1)})}unload(){this.toolbar?.parentNode?.removeChild(this.toolbar)}attachButtons(){y.forEach(([r,e])=>{let n=c("div","",{style:{display:"flex",flexDirection:"column",alignItems:"center",fontSize:".875rem",gap:".25rem"}}),o=c("span",r);n.appendChild(o);let s=c("div","",{style:{display:"flex",gap:".125rem"}});e.forEach(i=>{s.appendChild(this.buttons[i])}),n.appendChild(s),this.toolbar.appendChild(n)});let t=c("button","X",{style:{height:"2rem",width:"2rem",margin:"auto 0"},onclick:()=>this.unload()});this.toolbar.appendChild(t)}};var p=class{constructor(){}processSitemap(t,r=1,e=null,n=[]){return t.forEach(o=>{let s=o.id||`folder_${Math.random().toString(36).substr(2,7)}`;n.push({id:s,name:o.pageName,level:r,parentId:e,type:o.type}),o.children&&this.processSitemap(o.children,r+1,s,n)}),n}generateMermaidMarkup(t){let r=["graph TD","classDef containers fill:transparent,stroke-width:0",""],e=Math.max(...t.map(o=>o.level));for(let o=1;o<=e;o++){let s=t.filter(i=>i.level===o);r.push(""),r.push(`  subgraph tier${o}[" "]`),s.forEach(i=>{o===1?r.push(`    ${i.id}["${i.name}"]`):r.push(`    ${i.parentId} --- ${i.id}["${i.name}"]`)}),r.push("  end","")}return r.push(""),r.push(`  class ${Array.from({length:e},(o,s)=>`tier${s+1}`).join(",")} containers`),r.join(`\r
`)}findCurrentNode(t,r){for(let e of t){if(e.id===r)return e;if(e.children){let n=this.findCurrentNode(e.children,r);if(n)return n}}return null}};var m=class{constructor(){this.init()}async init(){let t={name:$axure.document.configuration.projectName,id:$axure.document.configuration.projectId};this.toolbar=new d(new p,$axure.document.sitemap.rootNodes)}};async function E(){await w(),window.AxureToMermaid=new m}E().catch(console.error);})();
